/*! jdb v0.0.1 | (c) 2014 metaist | http://opensource.org/licenses/MIT */
!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a(jQuery)}(function(a){var b={},c=Array.prototype,d=Object.prototype,e=c.slice,f=d.toString,g=d.hasOwnProperty,h=c.indexOf,i=Object.keys,j={};j.END_LOOP=b,j.each=j.forEach=function(a,c,d){if(null===a||void 0===a)return a;var e,f,g;if(a.length===+a.length){for(e=0,f=a.length;f>e;e++)if(g=d||a[e],b===c.call(g,a[e],e,a))return}else{var h=j.keys(a);for(e=0,f=h.length;f>e;e++)if(g=d||a[h[e]],b===c.call(g,a[h[e]],h[e],a))return}return a},j.map=j.collect=function(a,b,c){var d=[],e;return null===a||void 0===a?d:(j.each(a,function(a,f,g){e=c||a,d.push(b.call(c,a,f,g))}),d)},j.each("concat push slice sort splice".split(" "),function(){j[this]=c[this]}),j.indexOf=function(a,b,c){return null===b||void 0===b?-1:h.call(b,a,c)},j.inArray=function(a,b,c){return j.indexOf(a,b,c)>-1},j.merge=function(a,b){var c=+b.length,d=0,e=a.length;while(c>d)a[e++]=b[d++];if(c!==c)while(void 0!==b[d])a[e++]=b[d++];return a.length=e,a},j.keys=function(a){if(!j.isObject(a))return[];if(i)return i(a);var b=[];for(var c in a)j.has(a,c)&&b.push(c);return b},j.extend=function(a){return j.each(e.call(arguments,1),function(b){if(b)for(var c in b)a[c]=b[c]}),a};var k=function(a,b,c,d){if(a===b)return 0!==a||1/a==1/b;if(null==a||null==b)return a===b;var e=j.type(a);if(e!==j.type(b))return!1;switch(e){case"string":return a==String(b);case"number":return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case"date":case"boolean":return+a==+b;case"regexp":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if("object"!=typeof a||"object"!=typeof b)return!1;var f=c.length;while(f--)if(c[f]==a)return d[f]==b;var g=a.constructor,h=b.constructor;if(g!==h&&!(j.isFunction(g)&&g instanceof g&&j.isFunction(h)&&h instanceof h)&&"constructor"in a&&"constructor"in b)return!1;c.push(a),d.push(b);var i=0,l=!0;if("array"===e){if(i=a.length,l=i==b.length)while(i--)if(!(l=k(a[i],b[i],c,d)))break}else{for(var m in a)if(j.has(a,m)&&(i++,!(l=j.has(b,m)&&k(a[m],b[m],c,d))))break;if(l){for(m in b)if(j.has(b,m)&&!i--)break;l=!i}}return c.pop(),d.pop(),l};j.isEqual=function(a,b){return k(a,b,[],[])},j.has=function(a,b){return g.call(a,b)},j.dot=function(a,b){if(!b)return void 0;var c=a;return j.each(b.split("."),function(a){return j.has(c,a)?void(c=c[a]):(c=void 0,j.END_LOOP)}),c},j.noop=function(){},j.identity=function(a){return a},j.constant=function(a){return function(){return a}},j.property=function(a){return function(b){return b[a]}};var l={};j.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(a){l["[object "+a+"]"]=a.toLowerCase(),j["is"+a]=function(b){return j.isType(b,a)}}),j.type=function(a){if(j.isNullish(a))return a+"";var b=typeof a;return"object"===b||"function"===b?l[f.call(a)]||"object":b},j.isType=function(a,b){return arguments.length>2?j.inArray(j.type(a),arguments.slice(1)):b.toLowerCase()===j.type(a)},j.isNull=function(a){return null===a},j.isUndefined=function(a){return void 0===a},j.isMissing=j.isNullish=function(a){return null===a||void 0===a},j.isTruthy=function(a){return!j.isFalsy(a)},j.isFalsy=function(a){return j.isArray(a)?0===a.length:j.isObject(a)?0===j.keys(a).length:j.inArray(a,[0,!1,null,void 0])},j.toArray=function(a){return j.isArray(a)?a:j.has(a,"length")?j.merge([],a):[a]},j.toBoolean=function(a){return!!a};var m=function(a){if(a instanceof m)return a;if(!(this instanceof m))return new m(a);var b=this;return b._root=null,b._prev=null,b._on={},j.each("insert update merge remove".split(" "),function(a){b._on["before"+a]=[],b._on["after"+a]=[],b._on[a]=[]}),a&&b.insert(a,!1),b};m.options={id:"_id",events:!0};var n=m.fn=m.prototype={version:"0.0.1",constructor:m,concat:j.concat,push:j.push,splice:j.splice,indexOf:j.indexOf,length:0};n.clone=function(){return new m(this.get())};var o=/\S+/g,p=/^before/i;n.on=function(a,b){var c=this._root||this;return j.each(a.match(o),function(a){a=a.toLowerCase(),j.inArray(b,c._on[a])||c._on[a].push(b)}),c},n.off=function(a,b){var c=this._root||this;return j.each(a.match(o),function(a){if(a=a.toLowerCase(),b){var d=c._on[a].indexOf(b);d>-1&&c._on[a].splice(d,1)}else c._on[a]={}}),c},n.trigger=function(a,b,c){var d=this._root||this,e=this;return c=c||[],j.each(a.match(o),function(a){if(a=a.toLowerCase(),p.test(a)){c.unshift(null);for(var f=0,g=d._on[a].length;g>f;f++)c[0]=b,b=d._on[a][f].apply(b,c),j.isFalsy(b)&&(b=[]);e=b}else c.unshift(b),j.each(d._on[a],function(a){a.apply(b,c)})}),e};var q=(new Date).getTime();n.merge=n.upsert=function(a,b){var c=this,d=[],e={field:"id",events:m.options.events};switch(j.type(b)){case"string":e.field=b;break;case"boolean":e.events=b;break;case"object":j.extend(e,b)}e.events&&(a=c.trigger("beforemerge",a));var f=function(a){var b,f={};f[e.field]=a[e.field],b=c.find(f),b.length?b.update(a,{events:e.events}):b.insert(a,{events:e.events}),e.events&&(d.concat(b.get()),c.trigger("merge",b))};switch(j.type(a)){case"array":j.each(a,f);break;case"object":f(a)}return e.events&&c.trigger("aftermerge",d),this},n.insert=n.add=function(a,b){var c=this,d=[],e=j.extend({events:m.options.events},b);return j.isBoolean(b)&&(e.events=b),a=j.toArray(a),e.events&&(a=c.trigger("beforeinsert",a)),j.each(a,function(a){var b=j.extend({},a);b[m.options.id]=++q,c.push(b),d.push(b),c._root&&c._root.push(b),e.events&&c.trigger("insert",b)}),e.events&&c.trigger("afterinsert",d),this},n.update=n.set=function(a,b){var c=this,d=[],e=this.get(),f=j.extend({events:m.options.events},b),g;return j.isBoolean(b)&&(f.events=b),f.events&&(e=c.trigger("beforeupdate",e,[a])),j.each(e,function(b){g={},j.each(a,function(a,c){j.isFunction(a)&&(a=a.call(b,b)),a!==b[c]&&(g[c]=a,b[c]=a)}),f.events&&j.isTruthy(g)&&(d.push(b),c.trigger("update",b,[b,g]))}),f.events&&c.trigger("afterupdate",d),this},n.remove=n.del=function(a){var b=this,c=[],d=this.get(),e=j.extend({events:m.options.events},a),f,g,h=[];j.isBoolean(a)&&(e.events=a),e.events&&(d=b.trigger("beforeremove",d)),j.each(d,function(a){a[m.options.id]=null});var i=!0,k=function(a){g=a.length;while(g--)f=a[g],null===f[m.options.id]&&(a.splice(g,1),i&&e.events&&(c.push(f),a.trigger("remove",f)))},l=this;while(l)k(l),l=l._prev,i=!1;return e.events&&b.trigger("afterremove",c),this},n.slice=function(a,b){var c=this,d;return d=m(j.slice.call(c,a,b)),d._root=this._root||this,d._prev=this,d},n.eq=function(a){return j.isMissing(a)?this.slice(0,0):this.slice(a,a+1)},n.first=function(a){return j.isMissing(a)&&(a=1),this.slice(0,a)},n.last=function(a){return j.isMissing(a)&&(a=1),this.slice(-a)},n.end=function(){return this._prev||this},m.cmp={"<":function(a,b){return b>a},"<=":function(a,b){return b>=a},"=":function(a,b){return j.isEqual(a,b)},">":function(a,b){return a>b},">=":function(a,b){return a>=b},regex:function(a,b){return b.test(a)},"in":function(a,b){var c=!1;return j.isArray(a)?(j.each(a,function(a){return c=c||m.cmp["in"](a,b),c?j.END_LOOP:void 0}),c):(j.each(b,function(b){switch(j.type(b)){case"regexp":c=c||b.test(a);break;default:c=c||m.cmp["="](a,b)}return c?j.END_LOOP:void 0}),c)}};var r=function(a,b,c,d){var e=!0,f=!1;if("!"===c[0]&&(f=!0,c=c.substring(1)),!j.has(m.cmp,c))throw new TypeError("No operator: "+c);return e=m.cmp[c].call(a,b,d),f?!e:e};m.test=function(a,b){var c=!1;switch(j.type(b)){case"array":c=!1,j.each(b,function(b){return c=c||m.test(a,b),c?j.END_LOOP:void 0});break;case"object":c=!0,j.each(b,function(b,d){switch(j.type(b)){case"object":j.each(b,function(b,e){return c=c&&r(a,a[d],e,b),c?void 0:j.END_LOOP});break;case"array":c=c&&r(a,a[d],"in",b);break;case"regexp":c=c&&r(a,a[d],"regex",b);break;case"function":c=c&&b.call(a,a,a[d]);break;default:c=c&&r(a,a[d],"=",b)}return c?void 0:j.END_LOOP})}return c},n.filter=n.find=function(a){var b=this,c=[],d,e,f=b.length;if(!a)return this;if(!j.isFunction(a)){var g=a;a=function(a){return m.test(a,g)}}var h=m();return h._root=this._root||this,h._prev=this,b.each(function(b){!0===a.call(b,b)&&h.push(b)}),h};var s=/ desc$/i,t=/ (a|de)sc$/i;return n.sort=function(a){switch(j.type(a)){case"array":var b=this;j.each(a,function(a){b.sort(a)});break;case"function":j.sort.call(this,a);break;case"string":var c=s.test(a)?"<":">",d;a=a.replace(t,""),j.sort.call(this,function(b,d){var e=b[a],f=d[a];return e===f?0:m.cmp[c](e,f)?1:-1})}return this},n.each=function(a){return j.each(this,a)},n.map=function(a){return j.map(this,a)},n.get=function(a){return null===a||void 0===a?j.slice.call(this):0>a?this[a+this.length]:this[a]},n.index=function(a){var b={},c;return this.each(function(d){switch(j.type(a)){case"undefined":case"null":c=d[m.options.id];break;case"string":c=d[a];break;case"function":c=a.call(d,d)}if(j.has(b,c))throw new RangeError("Duplicate key: "+c);b[c]=d}),b},n.select=function(a,b){var c={},d={addId:!0,addMode:!0};j.isBoolean(a)?(d.addId=a,a=[]):j.isBoolean(b)?d.addId=b:j.extend(d,b),c[m.options.id]=d.addId;var e=function(a,b){j.isUndefined(b)&&(b="!"!==a[0],b||(a=a.substring(1))),b=j.toBoolean(b),b&&(d.addMode=!1),c[a]=b};switch(j.type(a)){case"string":e(a);break;case"array":j.each(a,function(a){e(a)});break;case"object":j.each(a,function(a,b){e(b,a)})}return this.map(function(a){var b={};return j.each(a,function(a,e){(d.addMode&&!1!==c[e]||!d.addMode&&!0===c[e])&&(b[e]=a)}),c[m._ID]&&(b[m._ID]=a[m._ID]),b})},window&&(window.jdb=m),m});
//# sourceMappingURL=jdb.min.map